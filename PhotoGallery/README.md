# README

应用的大致逻辑

## 第24章：图片下载

```
                 +------------------------+
                 |                        |
                 |    AsyncTask中获取json，|
                 |    以得到各图片地址      |
                 |                        |
                 +------------------------+


+-----------------+                              +--+------------+--+
|                 |     给我下载图片               |  | handler    |  |
|      主线程      +----------------------------> |  +------------+  |
|                 |                              |                  |
|  +----------+   | <----------------------------+  HandlerThread   |
|  | handler  |   |  图片下载完成，请更新视图       |                  |
+--+----------+---+                              +------------------+
```


## 第26章：在Server中开启AlarmManager

```
                             PendingIntent作为参数传递
                             给AlarmManager
       +-----------------+                          +-------------------+
       |                 |                          |                   |
       |  PendingIntent  +------------------------> |   AlarmManager    |
       |                 |                          |                   |
       |                 |                          |                   |
       +-----------------+                          +-------------------+


  PendingIntent用来包装Intent，                      开启Alarm，周期一到
  PendingIntent在系统某处长期保存，                   取出PendingIntent发送intent
  与当前应用无关。                                    使用该intent启动Server
                                                 +
                                                 |
                                                 |
   <---------------------------------------------+

  +
  |   startServer(intent)
  |   定时启动IntentServer，
  |
  v
+-+-----------------------------+
|                               |
|   onHandleIntent(intent){     |
|     //Handle Intent           |
|     //检查是否有(新图片)        |
|     //有，发送广播             | ----------------------+
|   }                           |                       |
|                               |                       V
+-------------------------------+
```


## 第27章：广播接收器

为解决手机重启后，Alarm失效；可以通过广播接收器接收系统启动时发送的intent，然后在接收器中开启Alarm。

另一个任务：过滤前台通知。就是当此应用处于可见周期内时，不弹出通知。

实现方法：改为发送有序广播，并为广播设置私有权限，然后使用两个广播接收器接收此广播。其中一个广播接收器(动态注册)是只有应用位于前台时才可接收广播，并在接收广播后
更改resultCode；另一个广播接收器为静态注册，并设置为最后一个接收此有序广播的接收器，它检测resultCode是否被更改，如果更改
则不发送通知，如果没有则发送通知（它还复制发送通知）。



```
+-------------------------------------------------------------------------------------------+
|                                                                                           |
|  sendOrderedBroadcast(Intent, String, BroadcastReceiver, Handler, int, String, Bundle),   |  发送有序广播，但这里传递的不是
|                                                                                           |  result receiver对象，而是null
+-------------------------------------------+-----------------------------------------------+
                                            |
                                            |
                                            |
                                            |
                                            |
                                            |
                                            v

                            +----------------------------------+
                            |                                  |
                            |                                  |
                            |          BroadcastReceiver       |        只在应用位于可见周期内时
                            |                                  |        才存在的BroadcastReceiver
                            |                                  |
                            |                                  |
                            +---------------+------------------+
                                            |
                                            |
                                            |
                                            |
                                            |
                                            |
                                            v

                +----------------------------------------------------------+
                |                                                          |
                |                                                          |
                |                                                          |
                |               BroadcastReceiver                          |      由于使用result receiver在这里不合适，
                |                                                          |      所以使用静态注册的BroadcastReceiver，
                |                                                          |      然后设置其优先级为最低来确保它是最后
                |                                                          |      接收到有序广播。(与result receiver一样的效果)
                +----------------------------------------------------------+

```




